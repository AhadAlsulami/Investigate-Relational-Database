/*Query 1 - query used for the first insight [Question1.1]*/

SELECT f.title AS film_title, c.name AS category_name, COUNT(r.rental_id) AS rental_count
 FROM film f
JOIN film_category fc
 ON f.film_id = fc.film_id 
JOIN category c
 ON fc.category_id = c.category_id
JOIN inventory i
 ON f.film_id = i.film_id
JOIN rental r
 ON i.inventory_id = r.inventory_id
WHERE c.name IN ('Animation', 'Children', 'Classics', 'Comedy', 'Family', 'Music')
GROUP BY 1,2
ORDER BY 2;




/*Query 2 - query used for the second insight [Question1.2]*/

SELECT f.title, sub.name, f.rental_duration, NTILE(4) OVER (ORDER BY f.rental_duration) AS standard_quartile
 FROM (
	SELECT c.name, c.category_id 
	 FROM category c 
	 WHERE c.name IN ('Animation', 'Children', 'Classics', 'Comedy', 'Family', 'Music') 
	 ORDER BY 1) sub
JOIN film_category fc 
 ON fc.category_id = sub.category_id
JOIN film f
 ON f.film_id = fc.film_id
GROUP BY 1,2,3;




/*Query 3 - query used for the third insight [Question1.3]*/

SELECT sub.name, sub.standard_quartile, count(sub.standard_quartile)
FROM (
	SELECT f.title, c.name, f.rental_duration, NTILE(4) OVER (ORDER BY f.rental_duration) AS standard_quartile
	 FROM category c
	JOIN film_category fc
       ON fc.category_id = c.category_id
      JOIN film f
       ON f.film_id = fc.film_id
      WHERE c.name IN ('Animation', 'Children', 'Classics', 'Comedy', 'Family', 'Music')) sub
GROUP BY 1,2
ORDER BY 1,2,3 DESC;




/*Query 4 - query used for the fourth insight [Question2.1]*/

SELECT DATE_PART('month', r.rental_date) Rental_month, DATE_PART('year', r.rental_date) Rental_year, s.store_id, COUNT(*)
 FROM rental r
JOIN staff s
 ON s.staff_id = r.staff_id
GROUP BY 1,2,3
ORDER BY 4 DESC; 